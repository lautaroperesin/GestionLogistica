<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GestionLogisticaApp.EnvioDetallePage"
             Title="Detalle de Envío"
             BackgroundColor="#F8F9FA">

    <Grid>
        <!-- Fondo decorativo superior -->
        <BoxView HeightRequest="180" VerticalOptions="Start">
            <BoxView.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#667eea" Offset="0.0" />
                    <GradientStop Color="#764ba2" Offset="1.0" />
                </LinearGradientBrush>
            </BoxView.Background>
        </BoxView>

        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="20">
                
                <!-- Header con numero de seguimiento -->
                <Frame Padding="25" 
                       CornerRadius="20" 
                       BackgroundColor="White" 
                       HasShadow="True"
                       Margin="0,10,0,0">
                    <Frame.Shadow>
                        <Shadow Brush="Black" Offset="0,4" Radius="15" Opacity="0.1"/>
                    </Frame.Shadow>
                    
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Número de Seguimiento" 
                               FontAttributes="Bold" 
                               FontSize="14" 
                               TextColor="#999999"
                               HorizontalOptions="Center"/>
                        
                        <Frame Padding="15,10" 
                               CornerRadius="10" 
                               BackgroundColor="#F0F0FF"
                               HasShadow="False"
                               HorizontalOptions="Center">
                            <Label Text="{Binding Envio.NumeroSeguimiento}" 
                                   FontSize="20" 
                                   FontAttributes="Bold"
                                   TextColor="#667eea"
                                   HorizontalOptions="Center"/>
                        </Frame>
                        
                        <BoxView Color="#E0E0E0" HeightRequest="1" Margin="0,10"/>
                        
                        <Label Text="Estado del Envío" 
                               FontAttributes="Bold" 
                               FontSize="16" 
                               TextColor="#333333"/>
                        
                        <Frame Padding="0" 
                               CornerRadius="12" 
                               BorderColor="#E0E0E0"
                               HasShadow="False"
                               BackgroundColor="#F8F9FA">
                            <Picker ItemsSource="{Binding EstadosPosibles}" 
                                    SelectedItem="{Binding SelectedEstado}" 
                                    FontSize="14" 
                                    TextColor="#333333"
                                    Margin="10,0"/>
                        </Frame>
                        
                        <Button Text="ACTUALIZAR ESTADO" 
                                Command="{Binding UpdateEstadoCommand}" 
                                BackgroundColor="#667eea"
                                TextColor="White"
                                FontSize="16"
                                FontAttributes="Bold"
                                CornerRadius="12"
                                HeightRequest="50">
                            <Button.Shadow>
                                <Shadow Brush="#667eea" Offset="0,4" Radius="8" Opacity="0.3"/>
                            </Button.Shadow>
                        </Button>
                        
                        <Label Text="{Binding Message}" 
                               TextColor="#10B981" 
                               FontSize="14"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Informacion general -->
                <Frame Padding="20" 
                       CornerRadius="15" 
                       BackgroundColor="White" 
                       HasShadow="True">
                    <Frame.Shadow>
                        <Shadow Brush="Black" Offset="0,2" Radius="10" Opacity="0.08"/>
                    </Frame.Shadow>
                    
                    <VerticalStackLayout Spacing="15">
                        <Grid ColumnDefinitions="Auto,*">
                            <BoxView BackgroundColor="#667eea" 
                                     WidthRequest="4" 
                                     HeightRequest="24"
                                     CornerRadius="2"
                                     VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="Información General" 
                                   FontAttributes="Bold" 
                                   FontSize="18" 
                                   TextColor="#333333"
                                   Margin="12,0,0,0"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <BoxView Color="#F0F0F0" HeightRequest="1"/>
                        
                        <Grid ColumnDefinitions="Auto,*" 
                              RowDefinitions="Auto,Auto,Auto,Auto,Auto" 
                              RowSpacing="15">
                            <Label Grid.Row="0" Grid.Column="0" Text="&#x1F4C5;" FontSize="18" VerticalOptions="Center" Margin="0,0,10,0"/>
                            <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="3">
                                <Label Text="Fecha de Creación" FontSize="12" TextColor="#999999"/>
                                <Label Text="{Binding Envio.FechaCreacionEnvio, StringFormat='{0:dd/MM/yyyy}'}" 
                                       FontSize="15" 
                                       TextColor="#333333"
                                       FontAttributes="Bold"/>
                            </VerticalStackLayout>
                            
                            <Label Grid.Row="1" Grid.Column="0" Text="&#x1F4C6;" FontSize="18" VerticalOptions="Center" Margin="0,0,10,0"/>
                            <VerticalStackLayout Grid.Row="1" Grid.Column="1" Spacing="3">
                                <Label Text="Fecha de Salida" FontSize="12" TextColor="#999999"/>
                                <Label Text="{Binding Envio.FechaSalida, StringFormat='{0:dd/MM/yyyy}'}" 
                                       FontSize="15" 
                                       TextColor="#333333"
                                       FontAttributes="Bold"/>
                            </VerticalStackLayout>
                            
                            <Label Grid.Row="2" Grid.Column="0" Text="&#x2696;" FontSize="18" VerticalOptions="Center" Margin="0,0,10,0"/>
                            <VerticalStackLayout Grid.Row="2" Grid.Column="1" Spacing="3">
                                <Label Text="Peso" FontSize="12" TextColor="#999999"/>
                                <Label Text="{Binding Envio.PesoKg, StringFormat='{0:F2} Kg'}" 
                                       FontSize="15" 
                                       TextColor="#333333"
                                       FontAttributes="Bold"/>
                            </VerticalStackLayout>
                            
                            <Label Grid.Row="3" Grid.Column="0" Text="&#x1F4E6;" FontSize="18" VerticalOptions="Center" Margin="0,0,10,0"/>
                            <VerticalStackLayout Grid.Row="3" Grid.Column="1" Spacing="3">
                                <Label Text="Volumen" FontSize="12" TextColor="#999999"/>
                                <Label Text="{Binding Envio.VolumenM3, StringFormat='{0:F2} M³'}" 
                                       FontSize="15" 
                                       TextColor="#333333"
                                       FontAttributes="Bold"/>
                            </VerticalStackLayout>
                            
                            <Label Grid.Row="4" Grid.Column="0" Text="&#x1F4DD;" FontSize="18" VerticalOptions="Start" Margin="0,0,10,0"/>
                            <VerticalStackLayout Grid.Row="4" Grid.Column="1" Spacing="3">
                                <Label Text="Descripción" FontSize="12" TextColor="#999999"/>
                                <Label Text="{Binding Envio.Descripcion}" 
                                       FontSize="15" 
                                       TextColor="#333333"
                                       LineBreakMode="WordWrap"/>
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Rutas -->
                <Frame Padding="20" 
                       CornerRadius="15" 
                       BackgroundColor="White" 
                       HasShadow="True">
                    <Frame.Shadow>
                        <Shadow Brush="Black" Offset="0,2" Radius="10" Opacity="0.08"/>
                    </Frame.Shadow>
                    
                    <VerticalStackLayout Spacing="15">
                        <Grid ColumnDefinitions="Auto,*">
                            <BoxView BackgroundColor="#3B82F6" 
                                     WidthRequest="4" 
                                     HeightRequest="24"
                                     CornerRadius="2"
                                     VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="Ruta del Envío" 
                                   FontAttributes="Bold" 
                                   FontSize="18" 
                                   TextColor="#333333"
                                   Margin="12,0,0,0"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <BoxView Color="#F0F0F0" HeightRequest="1"/>
                        
                        <Grid ColumnDefinitions="Auto,*" 
                              RowDefinitions="Auto,Auto,Auto" 
                              RowSpacing="15">
                            <Label Grid.Row="0" Grid.Column="0" Text="&#x1F4CD;" FontSize="20" VerticalOptions="Start" Margin="0,0,10,0"/>
                            <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="3">
                                <Label Text="Origen" FontSize="12" TextColor="#999999" FontAttributes="Bold"/>
                                <Label Text="{Binding Envio.Origen.DireccionCompleta}" 
                                       FontSize="15" 
                                       TextColor="#333333"
                                       LineBreakMode="WordWrap"/>
                            </VerticalStackLayout>
                            
                            <BoxView Grid.Row="1" Grid.Column="0" 
                                     BackgroundColor="#E0E0E0" 
                                     WidthRequest="2" 
                                     HeightRequest="30"
                                     HorizontalOptions="Center"
                                     Margin="9,0,0,0"/>
                            
                            <Label Grid.Row="2" Grid.Column="0" Text="&#x1F3AF;" FontSize="20" VerticalOptions="Start" Margin="0,0,10,0"/>
                            <VerticalStackLayout Grid.Row="2" Grid.Column="1" Spacing="3">
                                <Label Text="Destino" FontSize="12" TextColor="#999999" FontAttributes="Bold"/>
                                <Label Text="{Binding Envio.Destino.DireccionCompleta}" 
                                       FontSize="15" 
                                       TextColor="#333333"
                                       LineBreakMode="WordWrap"/>
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Vehiculo -->
                <Frame Padding="20" 
                       CornerRadius="15" 
                       BackgroundColor="White" 
                       HasShadow="True">
                    <Frame.Shadow>
                        <Shadow Brush="Black" Offset="0,2" Radius="10" Opacity="0.08"/>
                    </Frame.Shadow>
                    
                    <VerticalStackLayout Spacing="15">
                        <Grid ColumnDefinitions="Auto,*">
                            <BoxView BackgroundColor="#F59E0B" 
                                     WidthRequest="4" 
                                     HeightRequest="24"
                                     CornerRadius="2"
                                     VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="&#x1F69A; Vehículo" 
                                   FontAttributes="Bold" 
                                   FontSize="18" 
                                   TextColor="#333333"
                                   Margin="12,0,0,0"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <BoxView Color="#F0F0F0" HeightRequest="1"/>
                        
                        <Grid ColumnDefinitions="Auto,*" 
                              RowDefinitions="Auto,Auto,Auto" 
                              RowSpacing="12">
                            <Label Grid.Row="0" Grid.Column="0" Text="Marca:" FontSize="14" TextColor="#666666" FontAttributes="Bold"/>
                            <Label Grid.Row="0" Grid.Column="1" Text="{Binding Envio.Vehiculo.Marca}" FontSize="14" TextColor="#333333"/>
                            
                            <Label Grid.Row="1" Grid.Column="0" Text="Modelo:" FontSize="14" TextColor="#666666" FontAttributes="Bold"/>
                            <Label Grid.Row="1" Grid.Column="1" Text="{Binding Envio.Vehiculo.Modelo}" FontSize="14" TextColor="#333333"/>
                            
                            <Label Grid.Row="2" Grid.Column="0" Text="Patente:" FontSize="14" TextColor="#666666" FontAttributes="Bold"/>
                            <Label Grid.Row="2" Grid.Column="1" Text="{Binding Envio.Vehiculo.Patente}" FontSize="14" TextColor="#333333" FontAttributes="Bold"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Cliente -->
                <Frame Padding="20" 
                       CornerRadius="15" 
                       BackgroundColor="White" 
                       HasShadow="True">
                    <Frame.Shadow>
                        <Shadow Brush="Black" Offset="0,2" Radius="10" Opacity="0.08"/>
                    </Frame.Shadow>
                    
                    <VerticalStackLayout Spacing="15">
                        <Grid ColumnDefinitions="Auto,*">
                            <BoxView BackgroundColor="#10B981" 
                                     WidthRequest="4" 
                                     HeightRequest="24"
                                     CornerRadius="2"
                                     VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="&#x1F464; Cliente" 
                                   FontAttributes="Bold" 
                                   FontSize="18" 
                                   TextColor="#333333"
                                   Margin="12,0,0,0"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <BoxView Color="#F0F0F0" HeightRequest="1"/>
                        
                        <Grid ColumnDefinitions="Auto,*" 
                              RowDefinitions="Auto,Auto,Auto" 
                              RowSpacing="12">
                            <Label Grid.Row="0" Grid.Column="0" Text="Nombre:" FontSize="14" TextColor="#666666" FontAttributes="Bold"/>
                            <Label Grid.Row="0" Grid.Column="1" Text="{Binding Envio.Cliente.Nombre}" FontSize="14" TextColor="#333333"/>
                            
                            <Label Grid.Row="1" Grid.Column="0" Text="Email:" FontSize="14" TextColor="#666666" FontAttributes="Bold"/>
                            <Label Grid.Row="1" Grid.Column="1" Text="{Binding Envio.Cliente.Email}" FontSize="14" TextColor="#333333"/>
                            
                            <Label Grid.Row="2" Grid.Column="0" Text="Teléfono:" FontSize="14" TextColor="#666666" FontAttributes="Bold"/>
                            <Label Grid.Row="2" Grid.Column="1" Text="{Binding Envio.Cliente.Telefono}" FontSize="14" TextColor="#333333"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Tipo de Carga -->
                <Frame Padding="20" 
                       CornerRadius="15" 
                       BackgroundColor="White" 
                       HasShadow="True">
                    <Frame.Shadow>
                        <Shadow Brush="Black" Offset="0,2" Radius="10" Opacity="0.08"/>
                    </Frame.Shadow>
                    
                    <VerticalStackLayout Spacing="15">
                        <Grid ColumnDefinitions="Auto,*">
                            <BoxView BackgroundColor="#8B5CF6" 
                                     WidthRequest="4" 
                                     HeightRequest="24"
                                     CornerRadius="2"
                                     VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   Text="Tipo de Carga" 
                                   FontAttributes="Bold" 
                                   FontSize="18" 
                                   TextColor="#333333"
                                   Margin="12,0,0,0"
                                   VerticalOptions="Center"/>
                        </Grid>
                        
                        <BoxView Color="#F0F0F0" HeightRequest="1"/>
                        
                        <Label Text="{Binding Envio.TipoCarga.Nombre}" 
                               FontSize="15" 
                               TextColor="#333333"
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Espacio inferior -->
                <BoxView HeightRequest="20" BackgroundColor="Transparent"/>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Overlay de carga -->
        <Grid IsVisible="{Binding IsBusy}"
              BackgroundColor="#80000000"
              VerticalOptions="Fill"
              HorizontalOptions="Fill">
            <Frame CornerRadius="20"
                   BackgroundColor="White"
                   Padding="40"
                   WidthRequest="270"
                   HeightRequest="270"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   HasShadow="True">
                <VerticalStackLayout Spacing="20"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center">
                    <ActivityIndicator IsRunning="{Binding IsBusy}"
                                     Color="#667eea"
                                     WidthRequest="60"
                                     HeightRequest="50"
                                     HorizontalOptions="Center"/>
                    <Label Text="Cargando detalles..."
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#333333"
                           HorizontalOptions="Center"/>
                    <Label Text="Por favor espera"
                           FontSize="14"
                           TextColor="#666666"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>